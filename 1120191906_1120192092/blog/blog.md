# 地铁导航博客



## 1. 团队成员

> 成员1：
>
> * 姓名：曾群鸿
> * 学号：1120192092
>
> 成员2：
>
> * 姓名：肖誉
> * 学号：1120191906



## 2. 成果展示

### 1.1 命令行成果

#TODO 截图+解说

### 1.2 GUI成果

#TODO 截图展示+解说

### 1.3 web端成果

web端服务已经部署在云服务器上，请访问http://0x404.tech, 进行体验



## 3. PSP耗时

#TODO， 把那个表格复制过来，填一下



## 4. 需求分析



## 5. 接口设计

### 5.1 核心程序接口

#TODO

描述重要**模块接口的设计与实现过程**。设计包括代码如何组织，比如会有几个类，几个函数，他们之间关系如何，关键函数是否需要画出流程图？说明你的算法的关键（不必列出源代码），以及独到之处。

#### 5.1.1 概述

#### 5.1.2 UML图

#### 5.1.3 流程图（可能不需要）

### 5.2 GUI程序接口

#TODO

描述重要**模块接口的设计与实现过程**。设计包括代码如何组织，比如会有几个类，几个函数，他们之间关系如何，关键函数是否需要画出流程图？说明你的算法的关键（不必列出源代码），以及独到之处。

#### 5.2.1 概述

#### 5.2.2 UML

#### 5.2.3 流程图（可能不需要）

### 5.3 web程序接口

### 5.3.1 概述

web程序使用django框架作为后端，利用django自动生成的基本框架，主要完成路由的定义，前端界面的设计，在已有的核心程序subway中提供两个询问接口，供django的view模块调用。

#### 前端界面接口

前端界面主要的接口为向后端提交最短路线查询接口，以及提交遍历路径查询接口。

1. 提交最短路线查询接口，通过获取页面文本输入框的信息，利用`ajax`向指定路由提交，并等待后端响应。

   对响应结果进行判断处理，如果返回一个正常的绘画路径，则进行画布的输出，否则进行异常处理。

2. 提交遍历路径查询接口，通过获取页面文本输入框的信息，利用`ajax`向指定路由提交，并等待后端响应。

   对响应结果进行判断处理，如果返回一个正常的绘画路径，则进行画布的输出，否则进行异常处理。

#### 后端接口

后端接口主要分为django路由接口，django的view模块接口

1. django路由接口：通过路由解析，将前端发送的不同请求转到view模块中不同函数进行处理
2. view模块接口：调用核心程序提供的查询接口，将查询结果以HttpResponse返回

#### 核心程序接口

程序入口为subway.py，在core模块中已经完成所有功能的实现，在subway.py中增加两个web查询接口，以供django后端进行调用。

1. 查询最短路径接口，通过core模块的查询最短路径算法，得到一个站点路径名列表，再通过utils模块中获取站点在图上的相对坐标，返回结果。
2. 查询遍历路径接口，通过core模块的查询遍历路径算法，得到一个站点路径名列表，再通过utils模块中获取站点在图上的相对坐标，返回结果。

### 5.3.2 UML

web程序活动图如下

![](http://image-hosting-404.oss-cn-beijing.aliyuncs.com/img/web_pic1.png)

## 6. 测试
我们本次结对项目的测试基于`pytest`进行，该工具能自动检查代码中的测试模块，执行测试函数，自动化完成测试。

为保证代码的正确性，我们要求每完成一个新的功能，都需要由功能的实现者实现该模块的测试函数编写，并制定了`pre_commit`脚本，在每次提交前利用`pytest`完成所有模块的测试检查，只有所有测试通过后才能提交。

### 6.1 单元测试

### 6.2 功能测试

#TODO 搬文档过来，记得把代码pytest那些补过来，再补充几个通过pytest的截图



## 7. 性能测试



## 8. 代码规范

在结对编程时，我们对代码规范做出了如下几个基本原则：
* 遵循[Google Python代码风格](https://zh-google-styleguide.readthedocs.io/en/latest/google-python-styleguide/python_language_rules/)
* 代码风格尽量统一
* 每个功能模块需要有清晰的注释说明
* 使用[Google开源注释风格](https://zh-google-styleguide.readthedocs.io/en/latest/google-python-styleguide/python_style_rules/#comments)，边**尽量**在注释中举简单例子，便于理解

并且使用代码风格检查工具`black`和`pylint`进行代码风格的统一管理：
* [pylint](https://www.pylint.org/)，每次提交需要确保通过pylint
* [black](https://pypi.org/project/black/)，使用black帮助格式化代码风格，每次提交需确保通过black

为保证每次向服务器提交的代码都符合规范，我们制定了`pre_commit`脚本，该脚本会使用`black`和`pylint`对所提交代码进行分析，每次提交都需要保证通过该脚本的代码分析，从而保持代码风格的一致性和规范性。

## 9. git提交规范

为保证git提交的历史较容易追溯和明确修改内容，我们制定了如下git提交规范：

### 提交信息格式
* 每个git commit提交信息由`header`、`body`和`footer`三部分组成

* `body`和`footer`可以省略，`header`不可省略

* `header`由三个部分组成：`type`，`scope`，`subject`

* `scope`可省略，`type`和`subject`不可省略

  
提交格式如下所示：

```
<type>(<scope>): <subject>
<BLANK LINE>
<body>
<BLANK LINE>
<footer>
```

**参考提交格式**：

```
docs(blog): update blog of week1
```

```
test(model): add pytest on shortest path

In order to improve code instructions, the black box test method is used to design test cases 
```


### Header格式

#### type

* docs: 对blog或者readme等文档进行修改
* fix: 修复bug
* style: 调整代码或者注释格式，不改变代码实际功能
* test: 增加或者修改测试文件
* feat: 增加新的功能点
* perf: 提高代码性能
* refactor: 重构代码（即没有修复bug也没有增加功能点）

#### scope

* 本次提交影响的范围，scope的内容可以省略
* 在本项目中，scope可以为：
  * core
  * model
  * utils
  * subway
  * ...
* 如果觉得较难确定scope，可以不写

#### subject

* subject中填写本次提交的主题
* 第一个字母不要大写
* 结尾不加.(句号)


### body格式（可省略）

### footer格式（可省略）



## 10. 界面设计

### 10.1 GUI界面设计

#TODO

\- **界面模块的详细设计过程**：你的程序有用户界面么？在博客中详细介绍界面模块是如何设计的。

\- **界面模块与其它模块的对接**：详细地描述UI模块的设计与其他模块的对接，并在博客中截图实现的功能。界面/控制/数据模块体现了 [MVC 的设计模式](https://en.wikipedia.org/wiki/Model–view–controller)了么？

### 10.2 WEB界面设计

#### 10.2.1 详细设计过程
WEB界面的设计过程，主要先考虑站点显示功能的实现。当时想到一个比较简单的方法，设置一个画布，把北京地铁的图片作为画布的背景，然后在画布上进行打点画圆，通过不断地打点即可实现一个地铁站遍历的效果。

但是要完成这个功能首先需要确定的是打点的坐标从哪来，最后的实现方法为通过图片的像素逐一确定每个地铁站的像素坐标，然后与地铁背景图标坐标成等比例缩放，得到每个站点在图片上的相对坐标，然后利用相对坐标打点画图实现。

由于这个过程人为完成，所以在实现的过程中，经常会出现数据坐标有误的情况，因此处于不断地修复数据过程中。较为方便的是，由于存在遍历所有站点的功能，所以每当遍历完所有站点时，较容易找出哪些站点的坐标出现偏差，再进行修复即可。

其次，考虑用户与界面的交互。由于系统支持的功能较少，仅有遍历地铁站点和查询最短路径，出于使用的直观性，直接将用户交互界面设置在地铁画布的右边，分为上下两个区域，分别完成不同的功能交互。

WEB前端界面迭代过程：
* V1：支持输入站点查询后打点
* V2：在每次打点前先把画布上已有的点清空
* V3：修复了若干次相对坐标有误的数据
* V4：支持打点时当前所在站点为红色，已经经过的站点为黑色

当前WEB前端界面如下所示：
![](http://image-hosting-404.oss-cn-beijing.aliyuncs.com/img/web_pic2.png)

#### 10.2.2 界面模块与其他模块的对接
* 服务已部署于云服务器上，可以直接访问http://0x404.tech/

由于WEB后端采用Django框架，所以只需要配置Django路由和View模块即可完成后端处理前端的数据。

由于程序的功能不多，仅有查询最短路径和遍历所有站点两个功能，并且在前端已经预先设置好了接口。所以只需要指定两个路由路径，由前端发送数据到指定路径，再转接View模块的函数对数据进行处理即可。

因此在View模块中设置两个接口，用于处理前端发送请求，并且将前两阶段实现的subway核心模块封装到django中，在View模块中调用核心模块算法进行数据处理，返回HttpResponse。

在整个接口对接过程中，在设计上体现了MVC设计模式。前端界面通过ajax向指定路由发送POST请求，将前端的数据传到后端。后端路由解析对应的请求，发送给View模块下对应的处理函数。处理函数处理前端发送过来的数据，调用核心代码提供的query接口，完成数据的计算并发送给前端。


在这个过程中，路由扮演了Controller的角色，负责处理不同的请求，调用不同的view函数。而核心代码在这个过程中扮演了Model角色，负责处理数据。前端界面则扮演了View角色，通过接受后端传来的数据，进行不同的图案绘制和处理。
 



## 11. 结对过程



## 12. 收获体会